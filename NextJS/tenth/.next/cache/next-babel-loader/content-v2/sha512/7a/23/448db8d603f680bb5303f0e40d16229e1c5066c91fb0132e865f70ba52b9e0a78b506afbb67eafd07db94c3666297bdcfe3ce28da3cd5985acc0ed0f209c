{"ast":null,"code":"import { connectDatabase, insertDocument } from \"../../lib/db-util\";\n\nasync function handler(req, res) {\n  let client;\n\n  try {\n    client = await connectDatabase();\n  } catch (error) {\n    res.status(500).json({\n      message: \"Connecting to the database failed! \" + error\n    });\n    return;\n  }\n\n  if (req.method === \"POST\") {\n    const {\n      email,\n      name,\n      message\n    } = req.body;\n\n    if (!email.includes(\"@\") || !name || name.trim() === \"\" || !message || message.trim() === \"\") {\n      res.status(422).json({\n        message: \"Invalid input.\"\n      });\n      client.close();\n      return;\n    }\n\n    const newComment = {\n      email,\n      name,\n      message\n    };\n    let result;\n\n    try {\n      result = await insertDocument(client, \"comments\", newComment);\n      newComment._id = result.insertedId;\n      res.status(201).json({\n        message: \"Added comment.\",\n        comment: newComment\n      });\n    } catch (error) {\n      client.close();\n      res.status(500).json({\n        message: \"Inserting comment failed!\"\n      });\n    } finally {\n      client.close();\n    }\n  }\n}\n\nexport default handler;","map":null,"metadata":{},"sourceType":"module"}